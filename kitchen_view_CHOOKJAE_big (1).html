<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>주방 합계 (대형 뷰 · iPad 최적화)</title>
  <style>
    :root{
      --bg:#0b1220;        /* 배경 */
      --panel:#0f172a;     /* 패널 */
      --ink:#e5e7eb;       /* 메인 텍스트 */
      --muted:#94a3b8;     /* 서브 텍스트 */
      --line:#334155;      /* 구분선 */
      --accent:#22c55e;    /* 연결 상태 색 */
      --warn:#ef4444;
      --rowOdd:#0f172a;
      --rowEven:#111827;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--ink);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Helvetica,Arial,sans-serif}
    .wrap{min-height:100%;max-width:1400px;margin:0 auto;padding:16px 20px 24px}
    header{display:flex;align-items:baseline;gap:16px;margin-bottom:8px}
    h1{font-size:clamp(22px,3.5vw,44px);margin:0 0 6px 0;font-weight:800}
    .status{display:flex;gap:10px;align-items:center;margin-left:auto}
    .chip{border:1px solid var(--line);color:var(--muted);padding:6px 10px;border-radius:999px;font-size:clamp(12px,1.6vw,16px)}
    .chip.ok{border-color:#14532d;color:#bbf7d0;background:#052e16}
    .chip.err{border-color:#7f1d1d;color:#fecaca;background:#450a0a}
    .grid{display:grid;grid-template-columns: 1fr clamp(120px,22vw,280px); gap:14px; align-items:stretch}
    .head{color:var(--muted);font-size:clamp(14px,2.2vw,20px);padding:8px 14px;border-bottom:1px solid var(--line);position:sticky;top:0;background:linear-gradient(to bottom, rgba(11,18,32,.95), rgba(11,18,32,.6));backdrop-filter:blur(2px);z-index:3}
    .row{display:contents}
    .cell{padding: clamp(10px,2.2vh,22px) 16px;border-radius:14px;background:var(--panel);border:1px solid var(--line)}
    .menu{font-size:clamp(24px,4.5vw,52px);font-weight:800;letter-spacing:.2px}
    .qty{font-size:clamp(28px,5.2vw,72px);font-weight:900;text-align:right;
      font-variant-numeric:tabular-nums}
    .odd .cell{background:var(--rowOdd)}
    .even .cell{background:var(--rowEven)}
    .footer{display:flex;justify-content:space-between;align-items:center;color:var(--muted);
      margin-top:14px;font-size:clamp(12px,1.8vw,16px)}
    .legend{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--line);display:inline-block;margin-right:6px}
    .big{font-size:clamp(18px,2.8vw,24px);color:var(--ink)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>주방 합계</h1>
      <div class="status">
        <span id="conn" class="chip">연결 대기</span>
        <span id="upd" class="chip">업데이트 없음</span>
      </div>
    </header>

    <div class="head grid">
      <div>메뉴</div>
      <div style="text-align:right">합계</div>
    </div>

    <div id="rows"></div>

    <div class="footer">
      <div class="legend">
        <span class="dot"></span><span>0도 표시 · 실시간 갱신</span>
      </div>
      <div class="big">ROOM: <b>CHOOKJAE</b></div>
    </div>
  </div>

  <!-- Firebase v8 (로컬/호스팅 모두 호환) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    // ---- Firebase 설정 ----
    var firebaseConfig = {
      apiKey: "AIzaSyCWBPv3YgGKOH0b1e59I3QG9SfRtcNZSDY",
      authDomain: "chookjae-8e133.firebaseapp.com",
      projectId: "chookjae-8e133",
      storageBucket: "chookjae-8e133.firebasestorage.app",
      messagingSenderId: "82575498649",
      appId: "1:82575498649:web:364e9c286a9f3ae7474708",
      measurementId: "G-BQ95TPG37V",
      databaseURL: "https://chookjae-8e133-default-rtdb.firebaseio.com"
    };
    var ROOM_ID = "CHOOKJAE";
    var order = ["우삼겹숙주볶음","치즈김치전","만두계란탕","불닭콘치즈","치즈콘계란말이","두부김치","음료수"];

    // ---- 초기 렌더 (큰 타일 뷰) ----
    var rowsEl = document.getElementById('rows');
    function renderSkeleton(){
      rowsEl.innerHTML = "";
      order.forEach(function(name, i){
        var wrap = document.createElement('div');
        wrap.className = (i%2===0?'odd':'even');
        // grid-like row
        var left = document.createElement('div'); left.className='cell menu'; left.textContent=name;
        var right = document.createElement('div'); right.className='cell qty'; right.textContent='0'; right.dataset.key=name;
        var row = document.createElement('div'); row.className='grid row';
        row.appendChild(left); row.appendChild(right);
        rowsEl.appendChild(row); rowsEl.appendChild(document.createComment('row-end'));
      });
    }
    renderSkeleton();

    // ---- 시간 표시 ----
    function fmtTime(ms){
      if(!ms) return "업데이트 없음";
      var d=new Date(ms); var z=n=>String(n).padStart(2,'0');
      return "업데이트 "+d.getFullYear()+"-"+z(d.getMonth()+1)+"-"+z(d.getDate())+" "+z(d.getHours())+":"+z(d.getMinutes());
    }

    // ---- Firebase 구독 ----
    try{
      firebase.initializeApp(firebaseConfig);
      var db=firebase.database();
      document.getElementById('conn').textContent='연결 시도중…';

      db.ref('orders/'+ROOM_ID+'/footerTotals').on('value', function(snap){
        var v=snap.val();
        var connEl=document.getElementById('conn');
        connEl.textContent='연결됨'; connEl.classList.remove('err'); connEl.classList.add('ok');

        if(!v){ return; }
        order.forEach(function(name){
          var cell = rowsEl.querySelector('[data-key="'+name+'"]');
          if(cell){ cell.textContent = (v[name]||0); }
        });
        document.getElementById('upd').textContent = fmtTime(v.updatedAt);
      }, function(err){
        var connEl=document.getElementById('conn');
        connEl.textContent='연결 오류'; connEl.classList.add('err');
        console.log(err);
      });
    }catch(e){
      document.getElementById('conn').textContent='초기화 실패'; 
      document.getElementById('conn').classList.add('err');
      console.log(e);
    }
  </script>
</body>
</html>
