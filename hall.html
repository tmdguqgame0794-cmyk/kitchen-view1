<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>홀 보기전용 · 6×5 테이블 · 실시간</title>
<style>
:root{
  --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --line:#2b3444;
  --sky:#60a5fa33; --dark:#cbd5e133; --red:#fecaca33; --green:#86efac33; --yellow:#fde68a33;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Helvetica,Arial,sans-serif}
.wrap{padding:10px;max-width:1400px;margin:0 auto}
h1{margin:0 0 10px;font-size:clamp(20px,3.6vh,36px)}
.grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:12px}
.head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.tid{font-weight:900}
.people{font-size:13px;color:var(--muted)}
.items{font-size:13px;color:#cbd5e1;line-height:1.4;max-height:8lh;overflow:auto}
.sum{margin-top:6px;text-align:right;font-weight:900}
.badge{display:inline-block;padding:2px 6px;border-radius:999px;background:#334155;color:#e5e7eb;font-size:12px}
.c-sky{background:var(--sky)}
.c-dark{background:var(--dark)}
.c-red{background:var(--red)}
.c-green{background:var(--green)}
.c-yellow{background:var(--yellow)}
</style>
</head>
<body>
<div class="wrap">
  <h1>홀(보기 전용)</h1>
  <div id="grid" class="grid"></div>
</div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
(function(){
  var firebaseConfig = {
    apiKey: "AIzaSyCWBPv3YgGKOH0b1e59I3QG9SfRtcNZSDY",
    authDomain: "chookjae-8e133.firebaseapp.com",
    projectId: "chookjae-8e133",
    storageBucket: "chookjae-8e133.firebasestorage.app",
    messagingSenderId: "82575498649",
    appId: "1:82575498649:web:364e9c286a9f3ae7474708",
    measurementId: "G-BQ95TPG37V",
    databaseURL: "https://chookjae-8e133-default-rtdb.firebaseio.com"
  };
  var ROOM="CHOOKJAE";
  var CONFIG={
    menus:["우삼겹숙주볶음","치즈김치전","만두계란탕","불닭콘치즈","치즈콘계란말이","두부김치"],
    prices:{"우삼겹숙주볶음":18000,"치즈김치전":12000,"만두계란탕":16000,"불닭콘치즈":12000,"치즈콘계란말이":11000,"두부김치":12000,"COLA":2000,"CIDER":2000,"ZERO":2000},
    tables:24
  };
  try{ firebase.initializeApp(firebaseConfig); }catch(e){}
  var db=firebase.database();
  var grid=document.getElementById('grid');

  function tableLabel(i){ if(i<=20) return (i+1)+"번"; return "예비"+(i-20); }
  function priceOf(items){
    var sum=0;
    CONFIG.menus.forEach(function(name, i){
      var ordered = (items.menu && items.menu[i])? items.menu[i].filter(function(v){return v!==0;}).length : 0;
      sum += ordered * CONFIG.prices[name];
    });
    if(items.bev){
      sum += (items.bev.COLA?.qty||0)*CONFIG.prices.COLA;
      sum += (items.bev.CIDER?.qty||0)*CONFIG.prices.CIDER;
      sum += (items.bev.ZERO?.qty||0)*CONFIG.prices.ZERO;
    }
    return sum;
  }
  function isDeadlineSoon(r){
    var ts = r.timeStamp || r.firstServedAt;
    if(!ts) return false;
    var deadline = ts + 90*60*1000;
    return (deadline - Date.now()) <= 10*60*1000;
  }
  function stateClass(r){
    var ts = r.timeStamp || r.firstServedAt;
    var now=Date.now();
    var red=false, dark=false, green=false, sky=false, yellow=false;
    if((r.people>0 || rowAnyOrdered(r)) && !ts && !r.done){ yellow=true; }
    if(ts){
      var elapsed = now - ts;
      var remain  = (ts + 90*60*1000) - now;
      if(remain <= 10*60*1000){ red=true; }
      else if(elapsed >= 50*60*1000){ dark=true; }
      else{ sky=true; }
    }
    if(r.done) green=true;
    if(red) return 'c-red'; else if(dark) return 'c-dark'; else if(green) return 'c-green'; else if(sky) return 'c-sky'; else if(yellow) return 'c-yellow'; else return '';
  }
  function rowAnyOrdered(r){
    if(!r || !r.menu) return false;
    var menus = r.menu.some(function(c){ return c.some(function(v){return v!==0;}); });
    var bevs  = r.bev && ((r.bev.COLA?.qty||0)+(r.bev.CIDER?.qty||0)+(r.bev.ZERO?.qty||0))>0;
    return menus||bevs;
  }

  // 6×5 고정 배치(가시적으로는 순서만 중요)
  function ensureCard(i){
    var el=document.querySelector('[data-i="'+i+'"]');
    if(el) return el;
    el=document.createElement('div'); el.className='card'; el.dataset.i=i;
    el.innerHTML='<div class="head"><div class="tid"></div><div class="people"></div></div><div class="items"></div><div class="sum"></div>';
    grid.appendChild(el);
    return el;
  }

  for(let i=0;i<CONFIG.tables;i++){
    db.ref('orders/'+ROOM+'/tables/'+i).on('value', function(s){
      var v=s.val()||{};
      var card=ensureCard(i);
      card.className='card '+stateClass(v);
      card.querySelector('.tid').textContent=tableLabel(i);
      card.querySelector('.people').innerHTML = '<span class="badge">인원 '+(v.people||0)+'</span>';
      var lines=[];
      (v.menu||[]).forEach(function(c, mi){
        var qty = c.filter(function(x){return x!==0;}).length;
        if(qty>0) lines.push(CONFIG.menus[mi]+' × '+qty);
      });
      if(v.bev){
        if((v.bev.COLA?.qty||0)>0) lines.push('콜라 × '+v.bev.COLA.qty);
        if((v.bev.CIDER?.qty||0)>0) lines.push('사이다 × '+v.bev.CIDER.qty);
        if((v.bev.ZERO?.qty||0)>0) lines.push('제로콜라 × '+v.bev.ZERO.qty);
      }
      card.querySelector('.items').textContent = lines.join(' · ') || '—';
      card.querySelector('.sum').textContent = (priceOf(v)||0).toLocaleString('ko-KR')+'원';
    });
  }
})();
</script>
</body>
</html>
